%% -*- mode: erlang -*-
%% -------------------------------------------------------------------
%%
%% Copyright (c) 2011-2015 Basho Technologies, Inc.
%%
%% This file is provided to you under the Apache License,
%% Version 2.0 (the "License"); you may not use this file
%% except in compliance with the License.  You may obtain
%% a copy of the License at
%%
%%   http://www.apache.org/licenses/LICENSE-2.0
%%
%% Unless required by applicable law or agreed to in writing,
%% software distributed under the License is distributed on an
%% "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
%% KIND, either express or implied.  See the License for the
%% specific language governing permissions and limitations
%% under the License.
%%
%% -------------------------------------------------------------------

{erl_opts, [
    debug_info,
    warnings_as_errors,
    {parse_transform, lager_transform}
]}.
{deps, [
    % Make sure this precedes erlydtl which, as of this writing, will pull
    % in an older version that doesn't have the fix for namespaced types.
    {eunit_formatters, ".*", {git, "git://github.com/seancribbs/eunit_formatters", {branch, "master"}}},

    {erlydtl, ".*", {git, "git://github.com/erlydtl/erlydtl.git", {branch, "stable"}}},
    {lager, ".*", {git, "git://github.com/basho/lager.git", {branch, "feature/otp-17"}}},
    {riak_core, ".*", {git, "git://github.com/basho/riak_core.git", {branch, "feature/otp-17"}}},
    {webmachine, ".*", {git, "git://github.com/basho/webmachine.git", {branch, "feature/otp-17"}}}
]}.

{edoc_opts, [{preprocess, true}]}.

{erlydtl_opts, [
    {compiler_options, [report, return, debug_info]}
]}.

{cover_enabled, true}.

{xref_checks, []}.
{xref_queries, [{"(XC - UC) || (XU - X - B - \"(cluster_info|dtrace)\" : Mod)", []}]}.

{plugin_dir, "plugins"}.

{plugins, [rebar_js_handlebars_plugin,
           rebar_js_stylus_plugin,
           rebar_js_concatenator_plugin]}.

{js_handlebars, [
    {doc_root,   "priv/admin/js/templates"},
    {out_dir,    "priv/admin/js"},
    {target,     "Ember.TEMPLATES"},
    {compiler,   "Ember.Handlebars.compile"},
    {templates,  [{"generated/templates.js", ["application.hbs",
                                              "snapshot.hbs",
                                              "cluster.hbs",
                                              "nodes.hbs",
                                              "ring.hbs",
                                              "current_cluster_item.hbs",
                                              "current_nodes_item.hbs",
                                              "staged_cluster_item.hbs",
                                              "partition.hbs",
                                              "degenerate_preflist_chart.hbs",
                                              "quorum_unavailable_chart.hbs",
                                              "all_unavailable_chart.hbs",
                                              "loading.hbs"]}]}
]}.

{js_concatenator, [
    {doc_root,        "priv/admin/js/vendor"},
    {out_dir,         "priv/admin/js"},
    {concatenations,  [{"generated/vendor.js", ["jquery-1.10.2.js",
                                                "jquery-ui-1.8.16.custom.min.js",
                                                "handlebars-1.0.0.js",
                                                "ember-1.0.0.js",
                                                "ember-data-1.0.0-beta.1.js",
                                                "minispade.js",
                                                "d3.v3.min.js"], []}]}
]}.

{js_stylus, [
    {stylus_path,   "/usr/local/bin/stylus"},
    {doc_root,      "priv/admin/css"},
    {out_dir,       "priv/admin/css/compiled"},
    {stylesheets,   ["style.styl"]}
]}.
